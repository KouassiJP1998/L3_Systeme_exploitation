#include <string.h>
#include <errno.h>
#include <time.h>
#include <stdio.h>
#include <stdlib.h>
#include "shm-message.h"


int shm_message_copy(shm_message_t message_source, shm_message_t *message_target){
	if (shm_message_is_empty(*message_target)){
		shm_message_set_name(message_target, message_source.name);
		shm_message_set_text(message_target, message_source.text);
		return 0;
  }else{
		fprintf(stderr ,"./shm-client.out:%s:%d: Unable to copy the message because the target message is not empty.\n", __FILE__, __LINE__);
		return -1;
  }
}


void shm_message_empty(shm_message_t *message){
	strcpy(message->name,"");
	strcpy(message->text,"");
}


int shm_message_is_empty(shm_message_t message){
	if (strcmp(message.name, "") == 0 && strcmp(message.text, "") == 0)
		return -1;
  else
		return 0;
}


void shm_message_print(shm_message_t message){
	time_t t = time(NULL);
	struct tm tm = *localtime(&t);
	printf("%02d-%02d-%02d  %02d:%02d:%02d %s:%s \n",tm.tm_year + 1900,tm.tm_mon +1,tm.tm_mday, tm.tm_hour,tm.tm_min,tm.tm_sec,message.name,message.text);
}


int shm_message_set_name(shm_message_t *message, const char *name){
	if (strlen(name)+1 <= SHM_MESSAGE_NAME_SIZE){
		strcpy(message->name, name);
		return 0;
  }else{
		fprintf (stderr ,"./shm-client.out:%s:%d: Unable to set the \"%s\" message name because its \"%d\" size is greater than \"%d\".\n", __FILE__, __LINE__, name, (int) strlen(name)+1, SHM_MESSAGE_NAME_SIZE);
		return -1;
	}
}


int shm_message_set_text(shm_message_t *message, const char *text){
	if (strlen(text)+1 <= SHM_MESSAGE_TEXT_SIZE){
		strcpy(message->text, text);
		return 0;
	}else{
		fprintf (stderr ,"./shm-client.out:%s:%d: Unable to set the \"%s\" message text because its \"%d\" size is greater than \"%d\".\n", __FILE__, __LINE__, text, (int) strlen(text)+1, SHM_MESSAGE_TEXT_SIZE);
		return -1;
  }
}
